<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:security="http://www.springframework.org/schema/security"
       xsi:schemaLocation="
             http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
         	 http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd">
          
	<security:http auto-config='true'  use-expressions="true">  
		<security:csrf disabled="true" />
<!-- 		<security:intercept-url pattern="/mypage 주소 입력하면" access="isAuthenticated() 로그인된 아이디만 접근 가능" /> -->
<!-- 		<security:intercept-url pattern="/**" access="hasRole('ROLE_USER')" /> -->
		<security:intercept-url pattern="/login/mypage.do" access="isAuthenticated()" />
		<security:intercept-url pattern="/login/logout.do" access="permitAll" />
		<security:intercept-url pattern="/**" access="permitAll" />
		<security:form-login login-page="/login/loginform.do" 
						     login-processing-url="/login/logincheck.do"
						     username-parameter="id" 
						     password-parameter="password" 
						     authentication-failure-url="/login/loginform.do?error"
						     authentication-success-handler-ref="userSuccessHandler"
		/> 
		<security:session-management invalid-session-url="/login/loginform.do">
			<security:concurrency-control max-sessions="1" error-if-maximum-exceeded="false"/>
		</security:session-management>
	
		<security:logout invalidate-session="true" logout-url="/login/logout.do" logout-success-url="/login/loginform.do" />
	</security:http>
	
	<bean id="passwordEncoder" class=" org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder" />
	<bean id="userAuthProvider" class="pickme.com.a.login.util.UserAuthProvider" />
	
	<bean id="userSuccessHandler" class="pickme.com.a.login.util.UserSuccessHandler">
		<property name="defaultTargetUrl" value="/login/mypage.do" />
		<property name="alwaysUseDefaultTargetUrl" value="true"></property>		
	</bean>
	
    <security:authentication-manager> 
	    <security:authentication-provider ref="userAuthProvider"/>
	    <security:authentication-provider user-service-ref="loginServiceImpl"/>
	</security:authentication-manager>	

</beans>


